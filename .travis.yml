sudo: required
dist: trusty
language: java
jdk:
  - oraclejdk8
addons:
  apt:
    packages:
      - rpm
before_install:
    - sed -i.bak -e 's|https://nexus.codehaus.org/snapshots/|https://oss.sonatype.org/content/repositories/codehaus-snapshots/|g' ~/.m2/settings.xml
    - pwd
    - git clone --depth=50 --branch=2.0 https://github.com/Graylog2/graylog2-server.git /home/travis/build/cvtienhoven/graylog2-server
before_deploy:
  - mvn jdeb:jdeb && export RELEASE_DEB_FILE=$(ls target/*.deb)
  - mvn rpm:rpm && export RELEASE_RPM_FILE=$(find target/ -name '*.rpm' | tail -1)
  - rm -f target/original-*.jar
  - export RELEASE_PKG_FILE=$(ls target/*.jar)
  - echo "Deploying release to GitHub releases"
deploy:
  provider: releases
  api_key:
    secure: ZzYgfw7vuRay0Vjpj2XQ7KFzfu4othwWgufm44E5JsVyufK2L+UEwtj9cNgou4yNlAiGmk/1ymkGOp1zH5GU7+XHTxIbEnvYeW531eGxcm3X7xA5xpfAV+7ETcuYySI3DPetmU3FlA38e3G071EYdNErTvbEXhLMfHhtkzimmtzEM3YBe4WIW68OKmZ7EPzbbNL3Pc+C/xln9kF5peADILcAGHzou/Gz66by9jZ6DOveW/iUvARkeXK4n0UySqCcM0vSF+nnPfZYToD8wyLQgjg8B/zLFO8+lAD4ZoxP1810zPxT3gCLDgn+ab/rk2cMZSTmlvu8vrE0YrakaWyhC9bofO+noz0lqkb1+3mADqaPhnz4/AULWB7wQ6BcPPyBajZessZuiHyOk7gLlyvlDKOw9YtiUyW4jlDmjz28i6XGlW78pOum39dCTtQrOHxugtdvLDOVCpcdLrRLmgZaEXRW2CboXxGsT47GLfOmNMFgYqaoao5aNijU5qstYm15ep852pu3e/+ISKcanrpT6ZHxoqzfwj6MAHaN4GB2S4o7S4xQ3c/rurZOrH2rnL9mt16/OLLptoM1JFwv5nmI+2H6hLcp7zDlqNAkyTU/v7e18dRS3d4706gnjdE8iB4I21Z3xDHV+fXRh5VcZm/cE8LMZMH/FsmeK8S6ckAIg1Y=
  file:
    - "${RELEASE_PKG_FILE}"
    - "${RELEASE_DEB_FILE}"
    - "${RELEASE_RPM_FILE}"
  skip_cleanup: true
  on:
    tags: true
    jdk: oraclejdk8
